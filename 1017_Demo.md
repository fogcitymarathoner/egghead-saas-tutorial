# 10/17/2024

# egghead.io SAAS Tutorial with Untested Deploy to Netlify
Based on 3-year old [Build a SaaS product with Next.js, Supabase and Stripe](https://egghead.io/courses/build-a-saas-product-with-next-js-supabase-and-stripe-61f2bc20)
Building an online school selling lessons using NextJS, Supabase, and Stripe.
## [Supabase](https://supabase.com/)
3 application tables

1) Profile - Modifies baked-in user authentication table
1) Lessons - The Product
1) Premium_Content - Hidden extra columns for **Lessons**

### Automated **Supabase** features
* Oauth Signup/Authentication (**github**), creates ***user*** record
* **Postgres** triggers, automatically creates ***profile*** automatically upon signin
* **Postgres** http triggers, creation of ***profile*** calls ***NextJS*** callback which creates ***customer*** record in **Stripe**

### Application Features
* List of **Lessons** built at 'build time', static
* ***Lessons*** details page has extra, premium content (youtube link) if viewer is a member
* Pages with "protected" in url are behind authentication wall
* 
#### Visual Effects
* Login/Logout button toggles if logged in or logged out
* **Subscribe** is hidden if user is not a member

### Stripe Features
1) **Customer** table
2) **Products** table
3) Recurring subscription charging

# Demo Instructions
## Preparation
1) have supabase and stripe dashboards open, launch python test harness for create stripe customer
1) make sure github is logged-in
1) log out of nextJS app
1) delete stripe customers, users, and profiles
## Signup/Authentication Oauth-Github
1) show [netlify deployment](https://ubiquitous-smakager-2f8417.netlify.app/)
3) show empty customers (stripe), profiles and users (supabase)
4) go to [pricing page](http://localhost:3000/pricing), notice no **subscribe** button
1) go to a [protected page (lessons)](http://localhost:3000/protected/egghead), notice redirection to [Signup/login](http://localhost:3000/sign-in) page
1) press login through git button
3) show **postgres function** [create_profile_for_user](https://supabase.com/dashboard/project/dbcyjmepzqfqosqseuvs/database/functions)
2) notice nav bar has **signup** before logging in
3) show new customer and profile in ***supabase***
4) copy user id from Supabase to python test harness
4) show **postgres webhook trigger** [get_stripe_customer](https://supabase.com/dashboard/project/dbcyjmepzqfqosqseuvs/database/hooks), mention it's pointing to **Netlify**
4) notice you are in a **protected** page, notice new **user** and **profile** records
5) use Python test harness to run ***/api/create-stripe-customer*** for 'jon'

### Hidden Premium content
1) make sure user is not a member
2) go to to [pricing page](http://localhost:3000/pricing), notice no subscribe button
3) go to [lesson 1 page](http://localhost:3000/protected/egghead/1), notice no youtube link
4) go to [supabase profile table]() and make new user a member by setting ***is_member*** to ***true***
3) go to to [pricing page](http://localhost:3000/pricing, notice new subscribe button
4) go to [lesson 1 page](http://localhost:3000/protected/egghead/1), notice new youtube link

# Oauth - Providers
export type Provider =
| 'apple'
| 'azure'
| 'bitbucket'
| 'discord'
| 'facebook'
| 'figma'
| 'github'
| 'gitlab'
| 'google'
| 'kakao'
| 'keycloak'
| 'linkedin'
| 'linkedin_oidc'
| 'notion'
| 'slack'
| 'slack_oidc'
| 'spotify'
| 'twitch'
| 'twitter'
| 'workos'
| 'zoom'
| 'fly'

# remove supabase triggers
# stripe - mix one recurring (subscription), add-ons 